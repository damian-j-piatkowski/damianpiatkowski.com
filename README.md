# damianpiatkowski.com

Source code for the portfolio website hosted at [damianpiatkowski.com](https://damianpiatkowski.com).

## Environment Variables

The following environment variables need to be set for the Flask project to run correctly:

- `BASE_THUMBNAIL_PATH`: Path where blog post thumbnails will be stored.
- `SECRET_KEY`: Secret key for Flask session management.
- `FLASK_ENV`: The environment in which the Flask app is running (e.g., development, production). Determines the configuration to load and can affect debugging and logging.
- `PORTFOLIO_WEBSITE_FLASK_SECRET`: Additional secret key for extra security measures within the application.
- `MAIL_USERNAME`: The username for the email account used to send emails from the application.
- `MAIL_PASSWORD`: Application-specific password generated by Google for a Gmail account, specifically configured to allow your application to send emails via Gmail's SMTP server.
- `MAIL_RECIPIENT`: The default recipient email address for notifications or other email communications from the application.
- `DOWNLOAD_DIRECTORY`: The directory where downloaded files will be stored.
- `MYSQL_PASSWORD`: The password for the MySQL user.
- `MYSQL_ROOT_PASSWORD`: The password for the MySQL root user.
- `MYSQL_DATABASE`: The name of the MySQL database.
- `MYSQL_HOST`: The host address of the MySQL server (e.g., db or localhost).

Ensure that these environment variables are set in your environment before running the application.

## Docker Setup

### Install Docker

Ensure you have Docker Desktop installed on your machine. Docker Desktop includes Docker Engine, Docker CLI, and Docker Compose.

### Initial Setup

1. **Set environment variables in your system for development**.

    On Windows, you can set environment variables using the `setx` command in your Command Prompt. Open Command Prompt and execute the following commands:

    ```sh
    setx FLASK_ENV "development"
    setx FLASK_RUN_PORT "5000"
    setx DATABASE_URL "mysql+pymysql://user:your_dev_mysql_password@db/dev_db"
    setx MYSQL_DATABASE "dev_db"
    setx MYSQL_USER "user"
    setx MYSQL_PASSWORD "your_dev_mysql_password"
    setx MYSQL_ROOT_PASSWORD "your_dev_mysql_root_password"
    ```

2. **Build and start the services for the first time** for development:

    ```sh
    docker-compose up --build
    ```

### Running Tests

1. Use the separate `docker-compose.test.yml` for testing:

    ```sh
    docker-compose -f docker-compose.test.yml up --build
    ```
   The --abort-on-container-exit flag ensures that the services stop once the tests complete,
   which is useful for CI/CD pipelines.

### Subsequent Runs

- To start the services again without rebuilding the images
   (add a -d flag to start the Docker containers in detached mode):

**For Development**:

    ```sh
    docker-compose up

**For Testing**:

    ```sh
    docker-compose -f docker-compose.test.yml build --no-cache; docker-compose -f docker-compose.test.yml up -d; docker-compose -f docker-compose.test.yml up --abort-on-container-exit --exit-code-from test-runner

**Stopping the Services**

    ```sh
    docker-compose down

### Check Container Logs

Inspect the logs of your database container to ensure it started up correctly:

    ```sh
    docker-compose logs db

Look for any errors or warnings that might indicate issues with the database startup.

### Access the Web Container

To run commands inside the web container, you need to use `docker-compose exec`:

    ```sh
    docker-compose exec web bash

## Testing

### Testing Framework and Organization

This project uses `pytest` as the testing framework.  
Tests are organized into three main directories:

- **`unit`** – Tests for individual components, such as functions, models, and services, in isolation.
- **`integration`** – Tests that verify interactions between multiple components, such as repositories, services, and external APIs.
- **`e2e`** – End-to-end tests that simulate real user interactions and full workflows.

### Running Tests by Marker

Tests are categorized using `pytest` markers for selective execution.
Markers list can be found in pytest.ini under the [pytest] markers section.

**Run tests for a specific feature or route** (e.g., `/admin/upload_blog_posts` route):  
  ```bash
  pytest -m admin_upload_blog_posts
  ```

### Pytest Extensions for Test Execution Order

To improve test reliability and catch hidden dependencies, these extensions modify the order in which tests run:

- **[`pytest-random-order`](https://pypi.org/project/pytest-random-order/)** – Runs tests in a random order on each execution, helping to uncover implicit dependencies between tests.  
- **[`pytest-reverse`](https://pypi.org/project/pytest-reverse/)** – Runs tests in reverse order, useful for identifying order-dependent failures and ensuring tests do not rely on side effects from previous ones.  

#### Installation

Install these extensions with:
```bash
pip install pytest-random-order pytest-reverse
```

#### Usage

- **Run tests in a random order to detect hidden dependencies:**
  ```bash
  pytest --random-order
  ```
- **Run tests in reverse order to check for order-dependent failures:**
  ```bash
  pytest --reverse
  ```
- **Combine both for thorough test order variation:**
   ```bash
   pytest --random-order --reverse
   ```
  
### Coverage Measurement

This project uses [`pytest-cov`](https://pypi.org/project/pytest-cov/) to measure test coverage.

#### Installation

Install `pytest-cov` with:
```bash
pip install pytest-cov
```

#### Running Coverage Reports

- **Run all tests and display a coverage summary in the terminal:**
  ```bash
  pytest --cov=damianpiatkowski
  ```
- **Generate an HTML coverage report:**
  ```bash
  pytest --cov=damianpiatkowski --cov-report=html
  ```
This will create a `htmlcov/` directory containing an interactive HTML report.

- **Enforce a minimum coverage threshold (e.g., 90% required to pass):**
  ```bash
  pytest --cov=damianpiatkowski --cov-fail-under=90
  ```
  
#### Viewing the HTML Report

To open the generated HTML report:

- **Linux/macOS:**
  ```bash
  open htmlcov/index.html
  ```
- **Windows:**
  ```bash
  start htmlcov/index.html
  ```
This allows you to visually explore which parts of the code are covered by tests.

  






